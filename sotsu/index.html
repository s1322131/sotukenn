<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>Magic Wand Light</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  </head>

  <body>
    <a-scene vr-mode-ui="enabled: true">

      <!-- ■ 背景（360画像） -->
      <a-sky src="back.png"></a-sky>

      <!-- ■ 杖（光のエフェクトつき） -->
      <a-entity id="wandParent" position="0 1.6 -1">

        <!-- 杖本体 -->
        <a-cylinder height="1" radius="0.02" color="#553300" position="0 -0.5 0"></a-cylinder>

        <!-- 杖の先の光（ふわぁ〜っと発光） -->
        <a-entity id="wandLight"
          geometry="primitive: sphere; radius: 0.05"
          material="color: #88ccff; emissive: #88ccff; emissiveIntensity: 0.1; transparent: true; opacity: 0.8"
          position="0 0.5 0">
        </a-entity>

      </a-entity>

      <!-- ■ 光のふわっとアニメーション -->
      <a-animation
        attribute="material.emissiveIntensity"
        from="0.1"
        to="1.5"
        direction="alternate"
        dur="1200"
        repeat="indefinite">
      </a-animation>

      <a-animation
        attribute="scale"
        from="1 1 1"
        to="1.6 1.6 1.6"
        direction="alternate"
        dur="1200"
        repeat="indefinite"
        easing="easeInOutSine"
        begin="wandLight">
      </a-animation>

      <!-- ■ 光で周囲を照らすライト（ふわふわ変化） -->
      <a-light id="wandGlowLight"
        type="point"
        intensity="0.7"
        distance="2"
        color="#88ccff"
        position="0 1.6 -1">
      </a-light>

      <a-animation
        attribute="intensity"
        from="0.4"
        to="1.2"
        direction="alternate"
        dur="1200"
        repeat="indefinite">
      </a-animation>

      <!-- ■ Questコントローラー（右手のみ） -->
      <a-entity id="rightController"
        oculus-touch-controls="hand: right; model: false">
      </a-entity>

      <!-- ■ コントローラーで杖を動かす処理 -->
      <script>
        AFRAME.registerComponent("wand-follow", {
          init: function () {
            this.controller = document.getElementById("rightController");
            this.wand = document.getElementById("wandParent");
            this.glow = document.getElementById("wandGlowLight");
          },
          tick: function () {
            if (!this.controller) return;

            // コントローラーの位置・角度を取得してそのまま杖へ
            const pos = this.controller.object3D.position;
            const rot = this.controller.object3D.quaternion;

            this.wand.object3D.position.copy(pos);
            this.wand.object3D.quaternion.copy(rot);

            // 光のライトも杖の先を追従
            this.glow.object3D.position.set(
              pos.x,
              pos.y,
              pos.z
            );
          }
        });
      </script>

      <a-entity wand-follow></a-entity>

    </a-scene>
  </body>
</html>
