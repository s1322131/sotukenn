<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>VR Magic Wand</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene vr-mode-ui="enabled: true">

      <!-- 光線テクスチャ（必要なら差し替え） -->
      <a-assets>
        <img id="sparkTexture" src="/mnt/data/unnamed.jpg" />
      </a-assets>

      <!-- コントローラー -->
      <a-entity id="rightController" laser-controls="hand: right"></a-entity>

      <!-- 杖の先端（光エフェクトまとめ） -->
      <a-entity id="wandTip" position="0 1.2 -0.5">

        <!-- コア（強い白光） -->
        <a-sphere id="coreGlow"
          radius="0.015"
          material="color: white; emissive: white; emissiveIntensity: 4; opacity: 0; transparent: true">
        </a-sphere>

        <!-- 外光（青い光） -->
        <a-sphere id="outerGlow"
          radius="0.12"
          material="color: #66aaff; emissive: #66aaff; emissiveIntensity: 1.5; opacity: 0; transparent: true">
        </a-sphere>

        <!-- スパーク（光線） -->
        <a-plane id="sparkGlow"
          src="#sparkTexture"
          width="0.45" height="0.45"
          material="opacity: 0; transparent: true; emissive: white"
          look-at="[camera]">
        </a-plane>

        <!-- 周囲を照らすライト -->
        <a-entity id="wandLight"
          light="type: point; intensity: 0; distance: 3; decay: 2">
        </a-entity>

      </a-entity>

      <!-- 魔法制御スクリプト -->
      <script>
        AFRAME.registerComponent('lumos-control', {
          init: function () {
            const c = document.querySelector('#rightController');
            const core = document.querySelector('#coreGlow');
            const outer = document.querySelector('#outerGlow');
            const spark = document.querySelector('#sparkGlow');
            const light = document.querySelector('#wandLight');

            let on = false;

            c.addEventListener('triggerdown', () => {
              on = !on;

              if (on) {
                core.setAttribute('animation__core', {
                  property: "material.opacity",
                  from: 0, to: 1,
                  dur: 500, easing: "easeOutQuad"
                });

                outer.setAttribute('animation__outer', {
                  property: "material.opacity",
                  from: 0, to: 0.7,
                  dur: 1200, delay: 150,
                  easing: "easeOutQuad"
                });

                spark.setAttribute('animation__spark', {
                  property: "material.opacity",
                  from: 0, to: 0.9,
                  dur: 900, delay: 300,
                  easing: "easeOutQuad"
                });

                light.setAttribute('animation__light', {
                  property: "light.intensity",
                  from: 0, to: 1.6,
                  dur: 1200,
                  easing: "easeOutQuad"
                });

              } else {
                core.setAttribute('animation__coreoff', {
                  property: "material.opacity",
                  from: 1, to: 0,
                  dur: 600
                });

                outer.setAttribute('animation__outeroff', {
                  property: "material.opacity",
                  from: 0.7, to: 0,
                  dur: 700
                });

                spark.setAttribute('animation__sparkoff', {
                  property: "material.opacity",
                  from: 0.9, to: 0,
                  dur: 700
                });

                light.setAttribute('animation__lightoff', {
                  property: "light.intensity",
                  from: 1.6, to: 0,
                  dur: 800
                });
              }
            });
          }
        });
      </script>

      <a-entity lumos-control></a-entity>

    </a-scene>
  </body>
</html>
