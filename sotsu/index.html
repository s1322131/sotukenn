<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>VR 魔法杖＋先生モデル</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene vr-mode-ui="enabled: true" wand-light-control>

      <!-- 背景360度 -->
      <a-sky src="back.png" rotation="0 -90 0"></a-sky>

      <!-- カメラ -->
      <a-entity camera look-controls position="0 -3 0"></a-entity>



      <!-- 先生モデル（アニメーション付き） -->
      <a-entity id="teacher"
        gltf-model="teacher11.glb"
        animation-mixer
        position="0 -20 -20"
        rotation="0 10 0"
        scale="14 14 14">
      </a-entity>

      
      <!-- コントローラー（右手） -->
      <a-entity id="rightController" 
        laser-controls="hand: right" 
        raycaster="objects: .grabbable; far: 10" 
        oculus-touch-controls="hand: right; model: false" 
        vive-controls="hand: right" 
        windows-motion-controls="hand: right" 
        daydream-controls="hand: right" 
        gearvr-controls="hand: right"> 
        
        <!-- 杖（＋魔法光エフェクト） --> 
        <a-entity id="wand" 
          gltf-model="tsue2.glb"
          scale="0.2 0.2 0.2" 
          position="0 0 0"
          rotation="150 127 180"> 
          
          <!-- ◆ 魔法の光（脈動・揺らぎ） --> 
          <a-sphere id="wandGlow" 
            radius="0.06" color="#88ccff" 
            emissive="#88ccff" 
            emissiveIntensity="2" 
            visible="false" 
            position="-1 -1 -1" 
            animation__pulse="property: scale; dir: alternate; dur: 700; from: 1 1 1; to: 1.25 1.25 1.25; loop: true; easing: easeInOutSine" 
            animation__emissive="property: material.emissiveIntensity; dir: alternate; dur: 900; from: 1.5; to: 3.5; loop: true; easing: easeInOutSine"> </a-sphere>

          
          
          <!-- ◆ 周囲を照らすライト --> 
          <a-entity id="wandLight" 
            light="type: point; intensity: 0; distance: 4; decay: 2" 
            position="0 0.15 0"> 
          </a-entity> 

           <!-- 羽（白で表示） -->
          <a-entity id="feather"
            gltf-model="hane.glb"
            class="grabbable"
            grab-object
            position="0 -1 -3"
            rotation="0 90 0"
            scale="0.3 0.3 0.3"
            float-on-click>
          
            <!-- 浮遊アニメーション（デフォルトでは停止） -->
            <a-animation
              id="floatAnim"
              attribute="position"
              dur="3000"
              direction="alternate"
              repeat="indefinite"
              to="0 -0.7 -3"
              begin="startFloat">
            </a-animation>
    
          </a-entity>
          
        </a-entity> 
      
      </a-entity>

      <!-- ハンドトラッキング -->
      <a-entity id="rightHandTracking" hand-tracking-controls="hand: right"></a-entity>

      <!-- 左手 -->
      <a-entity id="leftHand"
        oculus-touch-controls="hand: left"
        hand-tracking-controls="hand: left">
      </a-entity>

      <!-- 照明 -->
      <a-entity light="type: ambient; intensity: 0.8"></a-entity>
      <a-entity light="type: directional; intensity: 0.6" position="1 3 2"></a-entity>

    </a-scene>

<script>
  AFRAME.registerComponent('float-on-click', {
    init: function () {
      const el = this.el;
  
      el.addEventListener('click', () => {
        el.emit('startFloat');   // アニメーション開始
      });
    }
  });
</script>


      
         
      

    
    <!-- ================================ -->
    <!-- 杖の光 ON/OFF スクリプト -->
    <!-- ================================ -->
    <script>
  AFRAME.registerComponent('wand-light-control', {
    init: function () {
      const controller = document.querySelector('#rightController');
      const glow = document.querySelector('#wandGlow');
      const light = document.querySelector('#wandLight');

      let on = false;

      // ダブルクリック判定
      let lastClick = 0;
      const threshold = 300; // 300ms以内に2回 → ダブルクリック

      controller.addEventListener('triggerdown', () => {
        const now = performance.now();

        if (now - lastClick < threshold) {
          // ダブルクリック成功 → 光のON/OFF切り替え
          on = !on;

          if (on) {
            glow.setAttribute('visible', true);
            light.setAttribute('light', 'intensity', 2);
          } else {
            glow.setAttribute('visible', false);
            light.setAttribute('light', 'intensity', 0);
          }
        }

        lastClick = now;
      });
    }
  });
</script>


  </body>
</html>


















































































