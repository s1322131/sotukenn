<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>VR 背景画像＋先生モデル配置</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene vr-mode-ui="enabled: true" lumos-control>

      <!-- 背景360度 -->
      <a-sky src="back.png" rotation="0 -90 0"></a-sky>

      <!-- カメラ -->
      <a-entity camera look-controls position="0 -3 0"></a-entity>

      <!-- 羽 -->
      <a-entity gltf-model="hane.glb"
        position="0 1.5 -3"
        rotation="0 90 0"
        scale="0.3 0.3 0.3">
      </a-entity>

      <!-- 先生モデル -->
      <a-entity id="teacher"
        gltf-model="teacher1.glb"
        position="0 -20 -10"
        rotation="90 70 0"
        scale="14 14 14">
      </a-entity>

      <!-- 別モデル（例） -->
      <a-entity gltf-model="https://drive.google.com/uc?export=download&id=1OCdmLq3GVszTa0f5S5DMlGM6QOEYYaVk"
        position="0 0 -50">
      </a-entity>


      <!-- ================================ -->
      <!-- コントローラー（右手） -->
      <!-- ================================ -->
      <a-entity id="rightController"
        oculus-touch-controls="hand: right; model: false"
        vive-controls="hand: right"
        windows-motion-controls="hand: right"
        daydream-controls="hand: right"
        gearvr-controls="hand: right">

        <!-- 杖モデル -->
        <a-entity id="wand"
          gltf-model="tsue2.glb"
          scale="0.2 0.2 0.2"
          position="0 0 0"
          rotation="70 0 0">

          <!-- ◆ 杖の先の光（見た目の光） -->
          <a-sphere id="wandGlow"
            radius="0.05"
            color="#ffffff"
            emissive="#ffffff"
            emissiveIntensity="0"
            position="0 0.15 0"
            material="opacity: 0; transparent: true">
          </a-sphere>

          <!-- ◆ 周りをほんのり照らすライト -->
          <a-entity id="wandRealLight"
            light="type: point; intensity: 0; distance: 3; decay: 2"
            position="0 0.15 0">
          </a-entity>

        </a-entity>
      </a-entity>

      <!-- ハンドトラッキング -->
      <a-entity id="rightHandTracking" hand-tracking-controls="hand: right"></a-entity>

      <!-- 左手 -->
      <a-entity id="leftHand"
        oculus-touch-controls="hand: left"
        vive-controls="hand: left"
        windows-motion-controls="hand: left"
        daydream-controls="hand: left"
        gearvr-controls="hand: left"
        hand-tracking-controls="hand: left">
      </a-entity>

      <!-- 照明 -->
      <a-entity light="type: ambient; intensity: 0.8"></a-entity>
      <a-entity light="type: directional; intensity: 0.6" position="1 3 2"></a-entity>

    </a-scene>

    <!-- ================================ -->
    <!-- ルーモス制御スクリプト -->
    <!-- ================================ -->
    <script>
      AFRAME.registerComponent('lumos-control', {
        init: function () {
          const controller = document.querySelector('#rightController');
          const glow = document.querySelector('#wandGlow');
          const realLight = document.querySelector('#wandRealLight');

          let isOn = false;

          controller.addEventListener('triggerdown', () => {
            isOn = !isOn;

            if (isOn) {

              // ① 光の形がふわっと浮かぶ
              glow.setAttribute('animation__appear', {
                property: 'material.opacity',
                from: 0,
                to: 0.8,
                dur: 900,
                easing: "easeOutQuad"
              });

              // ② 発光がふわ〜っと膨らむ
              glow.setAttribute('animation__glow', {
                property: 'material.emissiveIntensity',
                from: 0,
                to: 4,
                dur: 1500,
                delay: 200,
                easing: "easeOutExpo"
              });

              // ③ 周囲を照らすライトもじわっと点灯
              realLight.setAttribute('animation__lighton', {
                property: 'light.intensity',
                from: 0,
                to: 1.5,
                dur: 1200,
                delay: 300,
                easing: "easeOutQuad"
              });

            } else {

              // 発光を消す
              glow.setAttribute('animation__glowoff', {
                property: 'material.emissiveIntensity',
                from: 4,
                to: 0,
                dur: 800,
                easing: "easeOutQuad"
              });

              // 球体を透明に戻す
              glow.setAttribute('animation__fadeout', {
                property: 'material.opacity',
                from: 0.8,
                to: 0,
                dur: 700,
                delay: 300,
                easing: "easeOutQuad"
              });

              // 周囲のライトも消灯
              realLight.setAttribute('animation__lightoff', {
                property: 'light.intensity',
                from: 1.5,
                to: 0,
                dur: 900,
                easing: "easeOutQuad"
              });
            }
          });
        }
      });
    </script>

  </body>
</html>

